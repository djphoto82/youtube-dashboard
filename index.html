<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>YouTube 4K Dashboard - BenQ SW271C</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --card: #161616;
            --accent: #ff0000;
            --text: #ffffff;
            --border: #333;
        }

        body {
            margin: 0; padding: 25px;
            background: var(--bg); color: var(--text);
            font-family: 'Segoe UI', Arial, sans-serif;
            height: 100vh; display: flex; flex-direction: column;
            box-sizing: border-box; overflow: hidden;
        }

        #dashboard {
            display: grid;
            grid-template-columns: 2800px 1fr; /* 4K optimizacija */
            gap: 30px; height: 100%;
        }

        /* LEVI DEL */
        .left-side { display: flex; flex-direction: column; gap: 20px; overflow: hidden; }

        #player-wrap {
            width: 100%; height: 1200px;
            background: #000; border-radius: 15px; overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .controls-bar {
            display: flex; gap: 20px; align-items: center;
            padding: 15px; background: var(--card); border-radius: 12px;
        }

        .btn {
            background: #333; color: white; border: none;
            padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 1.1rem;
        }
        .btn:hover { background: var(--accent); }

        /* 8 PLAYLIST OKENC */
        .playlist-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 20px; flex-grow: 1; overflow-y: auto;
        }

        .pl-box {
            background: var(--card); border-radius: 12px;
            padding: 15px; border: 1px solid var(--border);
            display: flex; flex-direction: column;
        }

        .pl-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 8px;
        }

        .pl-name { font-weight: bold; font-size: 1.2rem; }

        .video-list { flex-grow: 1; overflow-y: auto; font-size: 0.95rem; }
        .v-item {
            padding: 8px; border-bottom: 1px solid #222;
            cursor: pointer; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .v-item:hover { color: #fff; background: #222; }

        /* DESNI DEL: ISKANJE */
        .search-side {
            background: var(--card); border-radius: 15px;
            padding: 20px; border: 1px solid var(--border);
            display: flex; flex-direction: column; gap: 15px;
        }

        .search-input-group { display: flex; gap: 10px; }
        input[type="text"] {
            flex-grow: 1; background: #000; border: 1px solid var(--border);
            color: white; padding: 15px; border-radius: 8px; font-size: 1.1rem;
        }

        #results { flex-grow: 1; overflow-y: auto; }
        .res-item {
            display: flex; gap: 15px; margin-bottom: 15px; padding: 10px;
            background: #1a1a1a; border-radius: 10px; align-items: center;
        }
        .res-item img { width: 140px; border-radius: 6px; cursor: pointer; }
        .res-info { flex-grow: 1; }

        /* MODAL ZA ZAMENJAVO */
        .hidden-select { display: none; margin-top: 5px; width: 100%; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
    </style>
</head>
<body>

<div id="dashboard">
    <div class="left-side">
        <div id="player-wrap"><div id="player"></div></div>

        <div class="controls-bar">
            <button class="btn" onclick="player.playVideo()">‚ñ∂ Play</button>
            <button class="btn" onclick="player.pauseVideo()">‚è∏ Pause</button>
            <button class="btn" onclick="player.previousVideo()">‚èÆ</button>
            <button class="btn" onclick="player.nextVideo()">‚è≠</button>
            <input type="range" min="0" max="100" value="50" onchange="player.setVolume(this.value)" style="width:200px">
            <button class="btn" onclick="login()" id="loginBtn">üîê Prijava v YouTube</button>
            <span id="status" style="font-size: 0.9rem; color: #888;">‚ùå Ni povezano</span>
        </div>

        <div class="playlist-grid" id="plGrid"></div>
    </div>

    <div class="search-side">
        <div class="search-input-group">
            <input type="text" id="sq" placeholder="I≈°ƒçi po YouTube (Enter)...">
            <button class="btn" onclick="search()">I≈°ƒçi</button>
        </div>
        <div id="results"></div>
    </div>
</div>

<script>
    const API_KEY = "AIzaSyA_pC145cW0j79pJdvj3ek79WTkhB-trww";
    const CLIENT_ID = "508122818593-g1hilfaj85gj78cd52r11s1j89kr1lsb.apps.googleusercontent.com";
    
    // Zaƒçetni seznam playlist
    let myPlaylists = [
        { name: "Eva muzka", id: "PLdIGqVOOqRjyIPXr1L7XLxJFWsk0-RZh7" },
        { name: "Eva - otro≈°ke pesmice", id: "PLdIGqVOOqRjwKyfQKlawmTTsTP_LnmsTH" },
        { name: "Festa Petra (SLO)", id: "PLdIGqVOOqRjyC5IJcn2C97kZRQtSGAthr" },
        { name: "Festa Petra (EX-YU)", id: "PLdIGqVOOqRjwFMJBZxkpQW1F95wLSpKWr" },
        { name: "Festa Petra (EX-YU) - novo", id: "PLdIGqVOOqRjz_WMEgyB8uqrgx1swfSedB" },
        { name: "Festa Petra (ostalo)", id: "PLdIGqVOOqRjy_Jei1fCrjLGWsfajDtoP8" },
        { name: "Festa Petra (ostalo) - novo", id: "PLdIGqVOOqRjxvG1nyjybTHqxaujAJuufA" },
        { name: "Festa Petra (Domaƒçe)", id: "PLdIGqVOOqRjymCCX1orA6kHUloHY3J2_T" }
    ];

    let player, accessToken, tokenClient;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%', width: '100%',
            videoId: '', playerVars: { listType: 'playlist', list: myPlaylists[0].id }
        });
    }

    // Inicializacija 8 okenc
    function initPlaylistGrid() {
        const grid = document.getElementById('plGrid');
        grid.innerHTML = '';
        myPlaylists.forEach((pl, index) => {
            const box = document.createElement('div');
            box.className = 'pl-box';
            box.innerHTML = `
                <div class="pl-header">
                    <span class="pl-name" id="name-${index}">${pl.name}</span>
                    <button class="btn" style="padding:4px 8px; font-size:0.8rem" onclick="toggleSelect(${index})">Zamenjaj</button>
                </div>
                <select class="hidden-select" id="sel-${index}" onchange="changeSlot(${index}, this.value)">
                    ${myPlaylists.map(p => `<option value="${p.id}" ${p.id === pl.id ? 'selected' : ''}>${p.name}</option>`).join('')}
                </select>
                <div class="video-list" id="list-${index}">Nalaganje...</div>
            `;
            grid.appendChild(box);
            fetchVideos(pl.id, index);
        });
    }

    async function fetchVideos(playlistId, index) {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=6&playlistId=${playlistId}&key=${API_KEY}`);
        const data = await res.json();
        const cont = document.getElementById(`list-${index}`);
        cont.innerHTML = '';
        if (data.items) {
            data.items.forEach(v => {
                const item = document.createElement('div');
                item.className = 'v-item';
                item.innerText = v.snippet.title;
                item.onclick = () => player.loadVideoById(v.snippet.resourceId.videoId);
                cont.appendChild(item);
            });
        }
    }

    function toggleSelect(i) {
        const s = document.getElementById(`sel-${i}`);
        s.style.display = s.style.display === 'block' ? 'none' : 'block';
    }

    function changeSlot(i, newId) {
        const nameSpan = document.getElementById(`name-${i}`);
        const selectedName = myPlaylists.find(p => p.id === newId).name;
        nameSpan.innerText = selectedName;
        fetchVideos(newId, i);
        toggleSelect(i);
    }

    document.getElementById('sq').addEventListener('keypress', (e) => { if(e.key === 'Enter') search(); });

    async function search() {
        const q = document.getElementById('sq').value;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(q)}&type=video&key=${API_KEY}`);
        const data = await res.json();
        const cont = document.getElementById('results');
        cont.innerHTML = '';
        data.items.forEach(item => {
            const div = document.createElement('div');
            div.className = 'res-item';
            div.innerHTML = `
                <img src="${item.snippet.thumbnails.default.url}" onclick="player.loadVideoById('${item.id.videoId}')">
                <div class="res-info">
                    <div style="font-weight:bold; cursor:pointer" onclick="player.loadVideoById('${item.id.videoId}')">${item.snippet.title}</div>
                    <button class="btn" style="margin-top:8px; font-size:0.8rem" onclick="toggleSaveUI('${item.id.videoId}', this)">Shrani v playlisto</button>
                    <div class="save-ui" style="display:none; margin-top:10px;"></div>
                </div>
            `;
            cont.appendChild(div);
        });
    }

    function toggleSaveUI(vidId, btn) {
        const uiDiv = btn.nextElementSibling;
        if (uiDiv.style.display === 'block') {
            uiDiv.style.display = 'none';
            return;
        }
        
        uiDiv.innerHTML = '';
        const sel = document.createElement('select');
        sel.style.width = "100%";
        sel.style.padding = "5px";
        
        // Dodamo obstojeƒçe playliste
        myPlaylists.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p.id;
            opt.textContent = p.name;
            sel.appendChild(opt);
        });
        
        // Dodamo mo≈ænost za novo playlisto
        const newOpt = document.createElement('option');
        newOpt.value = "CREATE_NEW";
        newOpt.textContent = "+ Ustvari novo playlisto";
        sel.appendChild(newOpt);
        
        const confirmBtn = document.createElement('button');
        confirmBtn.className = "btn";
        confirmBtn.style.width = "100%";
        confirmBtn.style.marginTop = "5px";
        confirmBtn.style.fontSize = "0.8rem";
        confirmBtn.innerText = "Potrdi";
        
        confirmBtn.onclick = async () => {
            if (sel.value === "CREATE_NEW") {
                const newTitle = prompt("Vnesi ime nove playliste:");
                if (newTitle) {
                    const newId = await createNewPlaylist(newTitle);
                    if (newId) {
                        await addToPlaylist(vidId, newId);
                        myPlaylists.push({ name: newTitle, id: newId });
                        initPlaylistGrid(); // Osve≈æimo 8 oken
                    }
                }
            } else {
                await addToPlaylist(vidId, sel.value);
            }
            uiDiv.style.display = 'none';
        };
        
        uiDiv.appendChild(sel);
        uiDiv.appendChild(confirmBtn);
        uiDiv.style.display = 'block';
    }

    async function createNewPlaylist(title) {
        if(!accessToken) return alert("Prijavi se!");
        const res = await fetch("https://www.googleapis.com/youtube/v3/playlists?part=snippet,status", {
            method: "POST",
            headers: { "Authorization": `Bearer ${accessToken}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                snippet: { title: title, description: "Ustvarjeno prek Dashboarda" },
                status: { privacyStatus: "public" }
            })
        });
        const data = await res.json();
        if(res.ok) {
            alert("‚úÖ Playlista ustvarjena!");
            return data.id;
        } else {
            alert("‚ùå Napaka pri ustvarjanju.");
            return null;
        }
    }

    async function addToPlaylist(vId, pId) {
        if(!accessToken) return alert("Prijavi se!");
        const res = await fetch("https://www.googleapis.com/youtube/v3/playlistItems?part=snippet", {
            method: "POST",
            headers: { "Authorization": `Bearer ${accessToken}`, "Content-Type": "application/json" },
            body: JSON.stringify({ snippet: { playlistId: pId, resourceId: { kind: "youtube#video", videoId: vId }}})
        });
        if(res.ok) alert("‚úÖ Video dodan!");
        else alert("‚ùå Napaka pri dodajanju.");
    }

    function initOAuth() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: "https://www.googleapis.com/auth/youtube",
            callback: (res) => { accessToken = res.access_token; document.getElementById("status").innerText = "‚úÖ Povezano"; }
        });
    }
    function login() { tokenClient.requestAccessToken(); }
    
    window.onload = () => {
        initOAuth();
        initPlaylistGrid();
    };
</script>
</body>
</html>