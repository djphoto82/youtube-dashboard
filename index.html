<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>YouTube Pro Dashboard 4K - Ultimate Fix 2026</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root { --bg: #0a0a0a; --card: #161616; --accent: #ff0000; --text: #fff; --border: #333; }
        body { margin: 0; padding: 20px; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; box-sizing: border-box; }
        
        #dashboard { display: grid; grid-template-columns: 2750px 1fr; gap: 40px; height: 100%; }
        .left-side { display: flex; flex-direction: column; gap: 15px; overflow: hidden; }

        #player-wrap { width: 100%; height: 1000px; background: #000; border-radius: 15px; overflow: hidden; border: 1px solid var(--border); }
        .controls-bar { display: flex; gap: 15px; align-items: center; padding: 12px; background: var(--card); border-radius: 12px; }
        
        input[type="range"] { height: 18px; cursor: pointer; width: 250px; accent-color: var(--accent); }

        .btn { background: #333; color: white; border: none; padding: 10px 18px; border-radius: 6px; cursor: pointer; font-size: 1rem; }
        .btn:hover { background: var(--accent); }

        .playlist-grid { display: grid; grid-template-columns: repeat(4, 660px); grid-template-rows: repeat(2, 480px); gap: 30px; flex-grow: 1; }
        .pl-box { background: var(--card); border-radius: 12px; padding: 12px; border: 1px solid var(--border); display: flex; flex-direction: column; width: 650px; }
        
        .pl-header { display: flex; flex-direction: column; gap: 8px; border-bottom: 1px solid #333; padding-bottom: 8px; margin-bottom: 8px; }
        .pl-top-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .pl-title-area { font-weight: bold; font-size: 1.0rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 250px; }
        .pl-actions { display: flex; gap: 4px; align-items: center; }
        
        .sort-btns { display: flex; gap: 3px; margin: 0 5px; }
        .btn-sort { background: #222; font-size: 0.65rem; padding: 3px 5px; border: 1px solid #444; color: #aaa; border-radius: 3px; cursor: pointer; }
        .btn-sort.active { color: #fff; border-color: var(--accent); }

        .pl-filter-input { background: #000 !important; color: #fff; border: 1px solid #444; padding: 6px; border-radius: 4px; font-size: 0.85rem; width: 100%; box-sizing: border-box; }

        .video-list { flex-grow: 1; overflow-y: auto; position: relative; }
        
        .v-item { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; font-size: 0.9rem; width: 100%; box-sizing: border-box; position: relative; }
        .v-item:hover { background: #222; }
        .v-title { flex: 1; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-right: 75px; min-width: 0; }
        .v-actions { position: absolute; right: 5px; display: flex; gap: 3px; background: inherit; padding-left: 5px; }

        .search-side { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 15px; overflow: hidden; }
        .btn-f { background: #222; color: #ccc; border: 1px solid #444; padding: 6px 10px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; }
        .btn-f.active { background: var(--accent); color: white; border-color: var(--accent); }

        .res-item { background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 15px; min-height: 480px; display: flex; flex-direction: column; gap: 8px; }
        .res-item img { width: 100%; border-radius: 8px; cursor: pointer; }

        #logModal { display: none; position: fixed; top: 10%; left: 30%; width: 40%; height: 70%; background: #1a1a1a; border: 2px solid var(--border); z-index: 1000; border-radius: 15px; padding: 20px; flex-direction: column; }
        #logContent { flex-grow: 1; overflow-y: auto; font-family: monospace; color: #0f0; background: #000; padding: 10px; border-radius: 5px; margin-bottom: 10px; }

        .move-menu { position: absolute; background: #222; border: 1px solid #555; padding: 10px; border-radius: 8px; z-index: 2000; display: none; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 250px; }
        
        .btn-mini { padding: 4px 6px; font-size: 0.75rem; background: #444; border-radius: 4px; border: none; color: white; cursor: pointer; line-height: 1; }
        .btn-mini:hover { background: var(--accent); }

        .video-list::-webkit-scrollbar { width: 10px; }
        .video-list::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.04); border-radius: 10px; }
        .video-list::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }
        
        /* === VOLUME SLIDER FIX === */
        #volSlider {
            width: 170px;
            height: 28px;
            cursor: pointer;
        }

        /* Chrome / Edge */
        #volSlider::-webkit-slider-runnable-track {
            height: 10px;
        }

        #volSlider::-webkit-slider-thumb {
            height: 20px;
            width: 20px;
            margin-top: -5px;
        }

        /* Firefox */
        #volSlider::-moz-range-track {
            height: 10px;
        }

        #volSlider::-moz-range-thumb {
            height: 20px;
            width: 20px;
        }        
        
    </style>
</head>
<body>

<div id="dashboard">
    <div class="left-side">
        <div id="player-wrap"><div id="player"></div></div>
        <div class="controls-bar">
            <button class="btn" onclick="togglePlay()">‚ñ∂ Play/Pause</button>
            <button class="btn" onclick="player.previousVideo()">‚èÆ</button>
            <button class="btn" onclick="player.nextVideo()">‚è≠</button>
            <input type="range" min="0" max="100" value="50" id="volSlider"
style="width:1400px; height:40px;"
onchange="player.setVolume(this.value)">
            <button class="btn" onclick="login()">üîê Prijava</button>
            <span id="status" style="font-size: 0.8rem; color: #666;">‚ùå Ni povezano</span>
        </div>
        <div class="playlist-grid" id="plGrid"></div>
    </div>

    <div class="search-side">
        <div style="display:flex; gap:10px;">
            <input type="text" id="sq" placeholder="I≈°ƒçi video..." style="flex-grow:1; background:#000; color:#fff; border:1px solid #333; padding:12px; border-radius:8px;">
            <button class="btn" onclick="search()">I≈°ƒçi</button>
            <button class="btn" onclick="toggleLog()">Log</button>
        </div>
        <div style="display:flex; flex-direction:column; gap:10px;">
            <span style="font-size:0.8rem; color:var(--accent); font-weight:bold;">FILTRI</span>
            <div style="display:flex; gap:5px; flex-wrap:wrap;">
                <button class="btn-f active" id="f-relevance" onclick="setSort('relevance', this)">Privzeto</button>
                <button class="btn-f" id="f-date" onclick="setSort('date', this)">Nazadnje dodano</button>
                <button class="btn-f" id="f-viewCount" onclick="setSort('viewCount', this)">Najbolj priljubljeni</button>
                <button class="btn-f" id="f-long" onclick="setSort('long', this)">Trajanje (Dolgi)</button>
            </div>
        </div>
        <div id="results"></div>
    </div>
</div>

<div id="logModal" tabindex="-1">
    <h3>Zgodovina aktivnosti (Log)</h3>
    <div id="logContent"></div>
    <div style="display:flex; gap:10px;">
        <button class="btn" style="background:#555" onclick="clearLog()">Izbri≈°i zgodovino</button>
        <button class="btn" onclick="toggleLog()">Zapri</button>
    </div>
</div>

<div id="moveMenu" class="move-menu" tabindex="-1">
    <h4 style="margin:0 0 10px 0; font-size: 0.9rem;">Dodaj/Premakni v:</h4>
    <div id="moveMenuList" style="max-height:300px; overflow-y:auto; margin-bottom:10px; font-size: 0.8rem;"></div>
    <button class="btn" style="width:100%; font-size:0.8rem" id="confirmMoveBtn">Potrdi</button>
</div>

<script>
    const API_KEY = "AIzaSyA_pC145cW0j79pJdvj3ek79WTkhB-trww";
    const CLIENT_ID = "508122818593-g1hilfaj85gj78cd52r11s1j89kr1lsb.apps.googleusercontent.com";
    
    let myPlaylists = [
        { name: "Eva muzka", id: "PLdIGqVOOqRjyIPXr1L7XLxJFWsk0-RZh7" },
        { name: "Eva - otro≈°ke pesmice", id: "PLdIGqVOOqRjwKyfQKlawmTTsTP_LnmsTH" },
        { name: "Festa Petra (SLO)", id: "PLdIGqVOOqRjyC5IJcn2C97kZRQtSGAthr" },
        { name: "Festa Petra (EX-YU)", id: "PLdIGqVOOqRjwFMJBZxkpQW1F95wLSpKWr" },
        { name: "Festa Petra (EX-YU) - novo", id: "PLdIGqVOOqRjz_WMEgyB8uqrgx1swfSedB" },
        { name: "Festa Petra (ostalo)", id: "PLdIGqVOOqRjy_Jei1fCrjLGWsfajDtoP8" },
        { name: "Festa Petra (ostalo) - novo", id: "PLdIGqVOOqRjxvG1nyjybTHqxaujAJuufA" },
        { name: "Festa Petra (Domaƒçe)", id: "PLdIGqVOOqRjymCCX1orA6kHUloHY3J2_T" }
    ];

    let player, accessToken, tokenClient;
    const allPlaylistItems = {};
    const sortModes = {};
    let currentSort = 'relevance', currentDuration = 'any';

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            playerVars: {
                listType: 'playlist',
                list: myPlaylists[0].id,
				index: 0,
                autoplay: 1
            },
            events: {
                onStateChange: onPlayerStateChange
            }
        });
    }

    function onPlayerStateChange(event) {
        console.log("STATE:", event.data);
        if (event.data === YT.PlayerState.ENDED) {
            player.nextVideo();
        }
    }

    function togglePlay() { player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo(); }

    function toggleLog() {
        const m = document.getElementById('logModal');
        m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
    }

    function clearLog() { document.getElementById('logContent').innerHTML = ''; }

    window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            document.getElementById('logModal').style.display = 'none';
            document.getElementById('moveMenu').style.display = 'none';
        }
    });

    async function fetchVideos(playlistId, index, nextPageToken = '') {
        if (!nextPageToken) {
            allPlaylistItems[playlistId] = [];
            sortModes[playlistId] = sortModes[playlistId] || 'date';
            updatePlaylistMeta(playlistId, index);
        }
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${API_KEY}&pageToken=${nextPageToken}`);
        const data = await res.json();
        if (data.items) {
            allPlaylistItems[playlistId].push(...data.items);
            if (data.nextPageToken) await fetchVideos(playlistId, index, data.nextPageToken);
            else renderVideos(playlistId, index);
        }
    }

    function renderVideos(playlistId, index, filterText = '') {
        const cont = document.getElementById(`list-${index}`);
        cont.innerHTML = '';
        let items = allPlaylistItems[playlistId].filter(v => v.snippet.title.toLowerCase().includes(filterText.toLowerCase()));
        
        if (sortModes[playlistId] === 'abc') items.sort((a, b) => a.snippet.title.localeCompare(b.snippet.title));
        else items.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));

        items.forEach(v => {
            const item = document.createElement('div');
            item.className = 'v-item';
            item.innerHTML = `
                <div class="v-title" onclick="player.playVideoAt(${items.indexOf(v)})">${v.snippet.title}</div>
                <div class="v-actions">
                    <button class="btn-mini" onclick="openMoveMenu(event, '${v.id}', '${v.snippet.resourceId.videoId}', '${playlistId}', '${v.snippet.title.replace(/'/g,"")}')">M</button>
                    <button class="btn-mini" onclick="deleteVideo('${v.id}', '${playlistId}', '${v.snippet.title.replace(/'/g,"")}')">X</button>
                </div>`;
            cont.appendChild(item);
        });
    }

    function setSortPL(playlistId, index, mode) {
        sortModes[playlistId] = mode;
        document.querySelectorAll(`#sort-${index} button`).forEach(b => b.classList.remove('active'));
        document.getElementById(`sort-${mode}-${index}`).classList.add('active');
        renderVideos(playlistId, index);
    }

    function setSort(mode, btn) {
        document.querySelectorAll('.btn-f').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if (mode === 'long') { currentSort = 'relevance'; currentDuration = 'long'; }
        else { currentSort = mode; currentDuration = 'any'; }
        search();
    }

    async function search() {
        const q = document.getElementById('sq').value;
        if (!q) return;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&q=${encodeURIComponent(q)}&type=video&order=${currentSort}&videoDuration=${currentDuration}&key=${API_KEY}`);
        const data = await res.json();
        const cont = document.getElementById('results');
        cont.innerHTML = '';
        for (let item of data.items) {
            const vidId = item.id.videoId;
            const det = await (await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics,contentDetails&id=${vidId}&key=${API_KEY}`)).json();
            const stats = det.items[0];
            cont.innerHTML += `
                <div class="res-item">
                    <img src="${item.snippet.thumbnails.high.url}" onclick="player.loadVideoById('${vidId}')">
                    <div style="font-weight:bold">${item.snippet.title}</div>
                    <div style="font-size:0.8rem; color:#aaa">
                        üëÅ ${parseInt(stats.statistics.viewCount).toLocaleString()} | ‚è± ${stats.contentDetails.duration.replace('PT','').replace('M','m ').replace('S','s')} | üìÖ ${timeAgo(item.snippet.publishedAt)}
                    </div>
                    <button class="btn" onclick="openMoveMenu(event, null, '${vidId}', null, '${item.snippet.title.replace(/'/g,"")}')">Shrani v playlisto</button>
                </div>`;
        }
    }

    async function openMoveMenu(event, pItemId, vId, fromPId, title) {
        const menu = document.getElementById('moveMenu');
        const list = document.getElementById('moveMenuList');
        menu.style.display = 'block';
        menu.style.top = (event.pageY + 10) + 'px';
        menu.style.left = (event.pageX - 240) + 'px';
        
        list.innerHTML = myPlaylists.map(p => `
            <label style="display:block; padding:5px; cursor:pointer; border-bottom: 1px solid #333">
                <input type="checkbox" value="${p.id}" data-name="${p.name}"> ${p.name}
            </label>
        `).join('');

        document.getElementById('confirmMoveBtn').onclick = async () => {
            const checks = Array.from(list.querySelectorAll('input:checked'));
            for (let c of checks) {
                const success = await addToPlaylist(vId, c.value, false);
                if (success) writeLog(`Dodan: <b>${title}</b> v playlisto <b>${c.getAttribute('data-name')}</b>`);
            }
            if (checks.length > 0 && pItemId && fromPId) {
                await deleteVideo(pItemId, fromPId, title, true);
                writeLog(`Premaknjen: <b>${title}</b> iz playliste`);
            }
            menu.style.display = 'none';
            refreshAllPlaylists();
        };
    }

    async function changePlaylist(index) {
        if(!accessToken) return alert("Prijavi se!");
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlists?part=snippet&mine=true&maxResults=50&key=${API_KEY}`, {
            headers: { "Authorization": `Bearer ${accessToken}` }
        });
        const data = await res.json();
        const names = data.items.map((p, i) => `${i}: ${p.snippet.title}`).join('\n');
        const choice = prompt("Izberi ≈°tevilko:\n" + names);
        if (choice !== null && data.items[choice]) {
            myPlaylists[index] = { name: data.items[choice].snippet.title, id: data.items[choice].id };
            initPlaylistGrid();
        }
    }

    async function renamePlaylist(playlistId, index) {
        const newName = prompt("Vnesi novo ime:", myPlaylists[index].name);
        if (newName) {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/playlists?part=snippet`, {
                method: "PUT", headers: { "Authorization": `Bearer ${accessToken}`, "Content-Type": "application/json" },
                body: JSON.stringify({ id: playlistId, snippet: { title: newName } })
            });
            if (res.ok) { myPlaylists[index].name = newName; initPlaylistGrid(); writeLog(`Preimenovana v: <b>${newName}</b>`); }
        }
    }

    async function deletePlaylist(playlistId, index) {
        if (confirm(`Izbri≈°em playlisto: ${myPlaylists[index].name}?`)) {
            const res = await fetch(`https://www.googleapis.com/youtube/v3/playlists?id=${playlistId}`, {
                method: "DELETE", headers: { "Authorization": `Bearer ${accessToken}` }
            });
            if (res.ok) { writeLog(`Izbrisana: <b>${myPlaylists[index].name}</b>`); myPlaylists.splice(index, 1); initPlaylistGrid(); }
        }
    }

    function sharePlaylist(id, name) {
        const body = encodeURIComponent(`≈Ωivijo, po≈°iljam ti YouTube playlisto: ${name}\nhttps://www.youtube.com/playlist?list=${id}`);
        window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=&su=${encodeURIComponent(name)}&body=${body}`);
    }

    async function updatePlaylistMeta(playlistId, index) {
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlists?part=contentDetails&id=${playlistId}&key=${API_KEY}`);
        const data = await res.json();
        if (data.items[0]) document.getElementById(`count-${index}`).innerText = `(${data.items[0].contentDetails.itemCount})`;
    }

    function writeLog(msg) {
        const now = new Date();
        const time = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        document.getElementById('logContent').innerHTML = `[${now.toLocaleDateString()} ${time}] ${msg}<br>` + document.getElementById('logContent').innerHTML;
    }

    async function deleteVideo(pItemId, pId, title, silent = false) {
        if (!silent && !confirm(`Izbri≈°em ${title}?`)) return;
        const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?id=${pItemId}`, {
            method: "DELETE", headers: { "Authorization": `Bearer ${accessToken}` }
        });
        if (res.ok) {
            if(!silent) writeLog(`Izbrisan video: <b>${title}</b>`);
            const idx = myPlaylists.findIndex(p => p.id === pId);
            if(idx !== -1) fetchVideos(pId, idx);
        }
    }

    async function addToPlaylist(vId, pId, notify = true) {
        const res = await fetch("https://www.googleapis.com/youtube/v3/playlistItems?part=snippet", {
            method: "POST", headers: { "Authorization": `Bearer ${accessToken}`, "Content-Type": "application/json" },
            body: JSON.stringify({ snippet: { playlistId: pId, resourceId: { kind: "youtube#video", videoId: vId }}})
        });
        return res.ok;
    }

    function refreshAllPlaylists() { myPlaylists.forEach((pl, i) => fetchVideos(pl.id, i)); }

    function timeAgo(date) {
        const diff = Math.floor((new Date() - new Date(date)) / 1000);
        if (diff < 86400) return "Danes";
        if (diff < 2592000) return Math.floor(diff/86400) + " dni nazaj";
        if (diff < 31536000) return Math.floor(diff/2592000) + " mesecev nazaj";
        return Math.floor(diff/31536000) + " let nazaj";
    }

    function initPlaylistGrid() {
        const grid = document.getElementById('plGrid');
        grid.innerHTML = '';
        myPlaylists.forEach((pl, index) => {
            const box = document.createElement('div');
            box.className = 'pl-box';
            box.innerHTML = `
                <div class="pl-header">
                    <div class="pl-top-row">
                        <span class="pl-title-area">${pl.name} <span id="count-${index}" style="color:var(--accent)">(...)</span></span>
                        <div class="sort-btns" id="sort-${index}">
                            <button class="btn-sort ${sortModes[pl.id] === 'date' ? 'active' : ''}" id="sort-date-${index}" onclick="setSortPL('${pl.id}', ${index}, 'date')">Zadnji dodani</button>
                            <button class="btn-sort ${sortModes[pl.id] === 'abc' ? 'active' : ''}" id="sort-abc-${index}" onclick="setSortPL('${pl.id}', ${index}, 'abc')">ABC</button>
                        </div>
                        <div class="pl-actions">
                            <button class="btn-mini" onclick="changePlaylist(${index})" title="Zamenjaj">‚ü≥</button>
                            <button class="btn-mini" onclick="sharePlaylist('${pl.id}', '${pl.name}')" title="Deli">‚úâ</button>
                            <button class="btn-mini" onclick="renamePlaylist('${pl.id}', ${index})" title="Preimenuj">‚úé</button>
                            <button class="btn-mini" onclick="deletePlaylist('${pl.id}', ${index})" title="Izbri≈°i">üóë</button>
                        </div>
                    </div>
                    <input type="text" class="pl-filter-input" placeholder="Filter videov..." oninput="renderVideos('${pl.id}', ${index}, this.value)">
                </div>
                <div class="video-list" id="list-${index}">Nalaganje...</div>
            `;
            grid.appendChild(box);
            fetchVideos(pl.id, index);
        });
    }

    function login() {
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID, scope: "https://www.googleapis.com/auth/youtube https://www.googleapis.com/auth/gmail.compose",
            callback: (res) => { accessToken = res.access_token; document.getElementById("status").innerText = "‚úÖ Povezano"; initPlaylistGrid(); }
        });
        tokenClient.requestAccessToken();
    }

    window.onload = initPlaylistGrid;
</script>
</body>
</html>