<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8">
<title>YouTube Playlist Dashboard</title>

<!-- GOOGLE OAUTH -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<!-- YOUTUBE IFRAME API -->
<script src="https://www.youtube.com/iframe_api"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    height: 100%;
}

#dashboard {
    display: grid;
    grid-template-columns: 3fr 1.3fr;
    gap: 20px;
    padding: 20px;
    height: 100vh;
    box-sizing: border-box;
}

/* PLAYER */
#player {
    width: 100%;
    height: 720px;
    border-radius: 12px;
    overflow: hidden;
}

/* CONTROLS */
#controls {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    align-items: center;
    margin-top: 10px;
}

button {
    font-size: 18px;
    padding: 8px 14px;
    cursor: pointer;
}

input[type="range"] {
    width: 200px;
}

/* PLAYLIST GRID */
#playlists {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.playlist-card {
    background: #222;
    padding: 12px;
    border-radius: 12px;
}

.playlist-card select {
    width: 100%;
    font-size: 16px;
}

/* SEARCH */
#search-panel {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

#search-panel input {
    font-size: 18px;
    padding: 10px;
}

#results {
    overflow-y: auto;
    flex: 1;
}

.result-item {
    background: #222;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
}
</style>
</head>

<body>

<div id="dashboard">

<!-- LEFT SIDE -->
<div>
    <div id="player"></div>

    <div id="controls">
        <button onclick="playVideo()">‚ñ∂ Play</button>
        <button onclick="pauseVideo()">‚è∏ Pause</button>
        <button onclick="prevVideo()">‚èÆ</button>
        <button onclick="nextVideo()">‚è≠</button>

        <label>
            üîä
            <input type="range" min="0" max="100" value="50"
                   onchange="setVolume(this.value)">
        </label>

        <button onclick="login()">üîê Prijava v YouTube</button>
        <span id="authStatus">‚ùå Ni prijavljen</span>
    </div>

    <div id="playlists"></div>
</div>

<!-- RIGHT SIDE -->
<div id="search-panel">
    <input type="text" id="searchQuery" placeholder="I≈°ƒçi video...">
    <button onclick="searchVideos()">I≈°ƒçi</button>
    <div id="results"></div>
</div>

</div>

<script>
/* ================= CONFIG ================= */
const API_KEY = "AIzaSyA_pC145cW0j79pJdvj3ek79WTkhB-trww";

const CLIENT_ID =
"508122818593-g1hilfaj85gj78cd52r11s1j89kr1lsb.apps.googleusercontent.com";

const playlists = [
  { name: "Eva muzka", id: "PLdIGqVOOqRjyIPXr1L7XLxJFWsk0-RZh7" },
  { name: "Eva - otro≈°ke pesmice", id: "PLdIGqVOOqRjwKyfQKlawmTTsTP_LnmsTH" },
  { name: "Festa Petra (SLO)", id: "PLdIGqVOOqRjyC5IJcn2C97kZRQtSGAthr" },
  { name: "Festa Petra (EX-YU)", id: "PLdIGqVOOqRjwFMJBZxkpQW1F95wLSpKWr" },
  { name: "Festa Petra (EX-YU) - novo", id: "PLdIGqVOOqRjz_WMEgyB8uqrgx1swfSedB" },
  { name: "Festa Petra (ostalo)", id: "PLdIGqVOOqRjy_Jei1fCrjLGWsfajDtoP8" },
  { name: "Festa Petra (ostalo) - novo", id: "PLdIGqVOOqRjxvG1nyjybTHqxaujAJuufA" },
  { name: "Festa Petra (Domaƒçe)", id: "PLdIGqVOOqRjymCCX1orA6kHUloHY3J2_T" }
];

let player;
let accessToken = null;
let tokenClient;

/* ================= YOUTUBE PLAYER ================= */
function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
        height: '720',
        width: '100%',
        playerVars: {
            listType: 'playlist',
            list: playlists[3].id
        }
    });
}

function playVideo() { player.playVideo(); }
function pauseVideo() { player.pauseVideo(); }
function nextVideo() { player.nextVideo(); }
function prevVideo() { player.previousVideo(); }
function setVolume(v) { player.setVolume(v); }

/* ================= PLAYLIST GRID ================= */
const grid = document.getElementById("playlists");

for (let i = 0; i < 8; i++) {
    const card = document.createElement("div");
    card.className = "playlist-card";

    const select = document.createElement("select");
    playlists.forEach(p => {
        const o = document.createElement("option");
        o.value = p.id;
        o.textContent = p.name;
        select.appendChild(o);
    });

    select.onchange = () => player.loadPlaylist({ list: select.value });
    card.appendChild(select);
    grid.appendChild(card);
}

/* ================= OAUTH ================= */
function initOAuth() {
    tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: "https://www.googleapis.com/auth/youtube",
        callback: (res) => {
            accessToken = res.access_token;
            document.getElementById("authStatus").textContent =
              "‚úÖ Prijavljen v YouTube";
        }
    });
}

function login() {
    tokenClient.requestAccessToken();
}

window.onload = initOAuth;

/* ================= SEARCH ================= */
async function searchVideos() {
    const q = document.getElementById("searchQuery").value;
    const res = await fetch(
        `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(q)}&key=${API_KEY}`
    );
    const data = await res.json();

    const results = document.getElementById("results");
    results.innerHTML = "";

    data.items.forEach(item => {
        const div = document.createElement("div");
        div.className = "result-item";

        const select = document.createElement("select");
        playlists.forEach(p => {
            const o = document.createElement("option");
            o.value = p.id;
            o.textContent = p.name;
            select.appendChild(o);
        });

        const btn = document.createElement("button");
        btn.textContent = "Shrani v playlisto";
        btn.onclick = () =>
            addToPlaylist(item.id.videoId, select.value);

        div.innerHTML = `<strong>${item.snippet.title}</strong><br>`;
        div.appendChild(select);
        div.appendChild(btn);

        results.appendChild(div);
    });
}

/* ================= ADD TO PLAYLIST ================= */
async function addToPlaylist(videoId, playlistId) {
    if (!accessToken) {
        alert("Najprej se prijavi v YouTube");
        return;
    }

    const res = await fetch(
        "https://www.googleapis.com/youtube/v3/playlistItems?part=snippet",
        {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${accessToken}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                snippet: {
                    playlistId: playlistId,
                    resourceId: {
                        kind: "youtube#video",
                        videoId: videoId
                    }
                }
            })
        }
    );

    if (res.ok) {
        alert("‚úÖ Video dodan v playlisto");
    } else {
        const err = await res.json();
        console.error(err);
        alert("‚ùå Napaka pri dodajanju");
    }
}
</script>

</body>
</html>
